<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إحصاء التلاميذ وهرم الأعمار</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
        }
        h1, h2, h3 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            font-weight: bold;
            font-size: 18px;
            text-align: center; /* توسيط القيم في الجدول */
        }
        th {
            background-color: lightyellow; /* تغيير اللون البرتقالي إلى أصفر فاتح */
        }
        .lightyellow {
            background-color: lightyellow; /* تغيير اللون البرتقالي إلى أصفر فاتح */
        }
        .lightgreen {
            background-color: lightgreen; /* تغيير اللون إلى أخضر فاتح */
        }
        .pink {
            background-color: pink;
        }
        .skyblue {
            background-color: skyblue;
        }
        .blue {
            background-color: blue;
            color: white;
        }
        .green {
            background-color: green;
            color: white;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: skyblue; /* تغيير لون الأزرار إلى أزرق سماوي */
            color: white;
            border: none;
        }
    </style>
</head>
<body>
    <h1>المدرسة الإعداديّة بمطماطة</h1>
    <h2>السنة الدراسية: 2024-2025</h2>

    <h3>إحصاء التلاميذ</h3>
    <div id="statTable"></div>
    <button onclick="exportStatTable()">إحصاء</button>

    <h3>هرم الأعمار</h3>
    <div id="pyrTable"></div>
    <button onclick="exportPyrTable()">الهرم</button>

    <h3>هرم الأعمار حسب المستوى</h3>
    <div id="pyrLevelTable"></div>
    <button onclick="exportPyrLevelTable()">الهرم2</button>

    <script>
        const apiKey = "AIzaSyD9lfpPzn4edNavV_eVnu-E8lKaNLWmfXk";
        const spreadsheetId = "1-p5lPL94cMj_0KyuGRm4n9Vb018KfQq3oAjIlAivHoM";

        async function fetchSheetData(sheetName) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.values;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function formatNumber(num) {
            return num === "0" ? "-" : num.padStart(2, '0');
        }

        function createTable(data, containerId, headerColor, rowColors, columnColors) {
            const container = document.getElementById(containerId);
            const table = document.createElement('table');
            data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                row.forEach((cell, colIndex) => {
                    const td = document.createElement('td');
                    td.textContent = formatNumber(cell);
                    if (rowIndex === 0 || colIndex === 0 || colIndex === row.length - 1) {
                        td.classList.add(headerColor);
                    }
                    if (rowColors[rowIndex + 1]) {
                        td.classList.add(rowColors[rowIndex + 1]);
                    }
                    if (columnColors.includes(colIndex + 1)) {
                        td.classList.add('lightgreen');
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
            container.appendChild(table);
        }

        async function loadStatTable() {
            const data = await fetchSheetData('Stat!A1:I18');
            if (data) {
                createTable(data, 'statTable', 'lightyellow', {
                    5: 'pink', 8: 'pink', 11: 'pink', 12: 'skyblue', 15: 'pink', 17: 'skyblue', 18: 'lightyellow'
                }, [2, 5, 8]);
            }
        }

        async function loadPyrTable() {
            const data = await fetchSheetData('Pyr!A1:K12');
            if (data) {
                createTable(data, 'pyrTable', 'lightyellow', {
                    2: 'skyblue', 3: 'skyblue', 4: 'skyblue', 5: 'skyblue', 6: 'skyblue', 7: 'skyblue', 8: 'skyblue', 9: 'skyblue', 10: 'skyblue', 11: 'skyblue', 12: 'pink'
                }, []);
            }
        }

        async function loadPyrLevelTable() {
            const data = await fetchSheetData('Pyr!A1:K12');
            if (data) {
                const headers = data[0];
                const levels = [
                    { name: "7أساسي", indices: [1, 2, 3] },
                    { name: "8أساسي", indices: [4, 5] },
                    { name: "9أساسي", indices: [6, 7] },
                    { name: "1ثانوي", indices: [8, 9] },
                    { name: "2علوم", indices: [10] }
                ];

                const levelData = [headers];
                levels.forEach(level => {
                    const row = [level.name];
                    headers.slice(1).forEach((header, colIndex) => {
                        const sum = level.indices.reduce((acc, index) => acc + parseInt(data[index][colIndex + 1] || 0), 0);
                        row.push(sum.toString());
                    });
                    levelData.push(row);
                });

                // Add a row for the total sum of each column
                const totalRow = ["المجموع"];
                headers.slice(1).forEach((header, colIndex) => {
                    const total = levelData.slice(1).reduce((acc, row) => acc + parseInt(row[colIndex + 1] || 0), 0);
                    totalRow.push(total.toString());
                });
                levelData.push(totalRow);

                createTable(levelData, 'pyrLevelTable', 'lightyellow', {
                    [levelData.length]: 'skyblue'
                }, []);
            }
        }

        function exportTable(containerId, fileName, title) {
            const container = document.getElementById(containerId);
            const tableHTML = container.innerHTML;
            const htmlContent = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; direction: rtl; text-align: right; }
                        h1, h2, h3 { text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; font-weight: bold; font-size: 18px; text-align: center; }
                        th { background-color: lightyellow; }
                        .lightyellow { background-color: lightyellow; }
                        .lightgreen { background-color: lightgreen; }
                        .pink { background-color: pink; }
                        .skyblue { background-color: skyblue; }
                        .blue { background-color: blue; color: white; }
                        .green { background-color: green; color: white; }
                    </style>
                </head>
                <body>
                    <h1>المدرسة الإعداديّة بمطماطة</h1>
                    <h2>السنة الدراسية: 2024-2025</h2>
                    <h3>${title}</h3>
                    ${tableHTML}
                </body>
                </html>
            `;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
        }

        function exportStatTable() {
            exportTable('statTable', 'إحصاء_التلاميذ.html', 'إحصاء التلاميذ');
        }

        function exportPyrTable() {
            exportTable('pyrTable', 'هرم_الأعمار.html', 'هرم الأعمار');
        }

        function exportPyrLevelTable() {
            exportTable('pyrLevelTable', 'هرم_الأعمار_حسب_المستوى.html', 'هرم الأعمار حسب المستوى');
        }

        loadStatTable();
        loadPyrTable();
        loadPyrLevelTable();
    </script>
</body>
</html>